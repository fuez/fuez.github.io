<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>shell - Andy's Blog</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="Andy Zhang"><meta name=description content="Mac iso date format: date -u +&amp;quot;%Y-%m-%dT%H:%M:%SZ&amp;quot; Single Brackets vs Double Brackets  The single bracket [ is actually a command. It has the same functionality as the test command, except that the last argument needs to be the closing square bracket ] A single bracket test will fail when one of its arguments is empty and gets substituted to nothing. You can prevent this error by quoting the variables (always a prudent solution) Double brackets in bash are not a command but a part of the language syntax."><meta name=keywords content="linux,SRE,software"><meta name=generator content="Hugo 0.60.1 with theme even"><link rel=canonical href=http://localhost:1313/post/tips/shell/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/dist/even.c2a46f00.min.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="shell"><meta property="og:description" content="Mac iso date format: date -u +&#34;%Y-%m-%dT%H:%M:%SZ&#34; Single Brackets vs Double Brackets  The single bracket [ is actually a command. It has the same functionality as the test command, except that the last argument needs to be the closing square bracket ] A single bracket test will fail when one of its arguments is empty and gets substituted to nothing. You can prevent this error by quoting the variables (always a prudent solution) Double brackets in bash are not a command but a part of the language syntax."><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/post/tips/shell/"><meta property="article:published_time" content="2018-08-13T10:41:52+08:00"><meta property="article:modified_time" content="2020-01-06T13:14:28+00:00"><meta itemprop=name content="shell"><meta itemprop=description content="Mac iso date format: date -u +&#34;%Y-%m-%dT%H:%M:%SZ&#34; Single Brackets vs Double Brackets  The single bracket [ is actually a command. It has the same functionality as the test command, except that the last argument needs to be the closing square bracket ] A single bracket test will fail when one of its arguments is empty and gets substituted to nothing. You can prevent this error by quoting the variables (always a prudent solution) Double brackets in bash are not a command but a part of the language syntax."><meta itemprop=datePublished content="2018-08-13T10:41:52+08:00"><meta itemprop=dateModified content="2020-01-06T13:14:28+00:00"><meta itemprop=wordCount content="997"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="shell"><meta name=twitter:description content="Mac iso date format: date -u +&#34;%Y-%m-%dT%H:%M:%SZ&#34; Single Brackets vs Double Brackets  The single bracket [ is actually a command. It has the same functionality as the test command, except that the last argument needs to be the closing square bracket ] A single bracket test will fail when one of its arguments is empty and gets substituted to nothing. You can prevent this error by quoting the variables (always a prudent solution) Double brackets in bash are not a command but a part of the language syntax."><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Andy's Blog</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a><a href=/about/><li class=mobile-menu-item>About</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>Andy's Blog</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li><li class=menu-item><a class=menu-item-link href=/about/>About</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>shell</h1><div class=post-meta><span class=post-time>2018-08-13</span><div class=post-category><a href=/categories/tip/>tip</a></div><span class=more-meta>997 words</span>
<span class=more-meta>5 mins read</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><a href=#mac-iso-date-format-date-u-ymdthmsz>Mac iso date format: date -u +"%Y-%m-%dT%H:%M:%SZ"</a></li><li><a href=#single-brackets-vs-double-bracketshttpsscriptingosxcom201802singlebracketsvsdoublebrackets>Single Brackets vs Double Brackets</a></li><li><a href=#how-to-check-string-starts-with-some-substring>How to check string starts with some sub-string?</a></li><li><a href=#lcall>LC_ALL</a></li><li><a href=#what-does-echo-powerlevel9kdisableconfigurationwizardtrue--zshrc-means>What does echo 'POWERLEVEL9K_DISABLE_CONFIGURATION_WIZARD=true' >>! ~/.zshrc means</a></li><li><a href=#mac-iso-date-format-date-u-ymdthmsz1>Mac iso date format: date -u +"%Y-%m-%dT%H:%M:%SZ"</a></li><li><a href=#single-brackets-vs-double-bracketshttpsscriptingosxcom201802singlebracketsvsdoublebrackets1>Single Brackets vs Double Brackets</a></li><li><a href=#how-to-check-string-starts-with-some-substring1>How to check string starts with some sub-string?</a></li><li><a href=#lcall1>LC_ALL</a></li><li><a href=#redirect-output-to-stderr-exec-12>Redirect output to stderr: exec 1>&2</a></li><li><a href=#how-can-i-make-press-any-key-to-continue>How can I make press any key to continue?</a></li><li><a href=#scriptdir-cd--dirname-bashsource0---pwd--to-get-the-current-script-dir>SCRIPTDIR=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd ) to get the current script dir</a></li><li><a href=#use-read-to-read-input-from-stdin-like-this-read-p-you-name-please-r-name>use read to read input from stdin like this: read -p "you name please:" -r NAME</a></li><li><a href=#why-usrbinenv-bash-is-better-than-binbash>Why #!/usr/bin/env bash is better than #!/bin/bash</a></li><li><a href=#bash-automated-testing-systemhttpsgithubcombatscorebatscore-could-be-used-to-test-bash-scripts-like-this>Bash Automated Testing System could be used to test bash scripts like this:</a></li><li><a href=#about-shell-parameter-substituationhttpswwwcybercitibiztipsbashshellparametersubstitution2html>About shell parameter substituation</a></li><li><a href=#difference-between-varnamevalue-and->Difference between ${varname:=value} and `$</a></li><li><a href=#what-does-colon--means-in-bash>What does colon : means in bash?</a></li></ul></nav></div></div><div class=post-content><h2 id=mac-iso-date-format-date-u-ymdthmsz>Mac iso date format: <code>date -u +"%Y-%m-%dT%H:%M:%SZ"</code></h2><h2 id=single-brackets-vs-double-bracketshttpsscriptingosxcom201802singlebracketsvsdoublebrackets><a href=https://scriptingosx.com/2018/02/single-brackets-vs-double-brackets/>Single Brackets vs Double Brackets</a></h2><blockquote><p>The single bracket [ is actually a command. It has the same functionality as the test command, except that the last argument needs to be the closing square bracket ]
A single bracket test will fail when one of its arguments is empty and gets substituted to nothing. You can prevent this error by quoting the variables (always a prudent solution)
Double brackets in bash are not a command but a part of the language syntax.
With double brackets you can also use two equals characters == for a more C like syntax. (or, better, use ((…)) syntax for arithmetic expressions)
Since the single bracket is a command, many characters it uses for its arguments need to be escaped to work properly; Double brackets interpret these characters properly. You can also use the (again more C like) && and || operators instead of -a and -o: <code>[[ ( $a == $b ) || ( $a == $c ) ]]</code>
With double brackets you can compare to * and ? wildcards, and bracket globbing […]. <code>a=hat; [[ $a = ?at ]] && echo match; [[ $a = [chrp]at ]] && echo match</code>
You can also use &lt; and > to compare strings lexicographically
And you get an operator =~ for regular expressions</p></blockquote><h2 id=how-to-check-string-starts-with-some-substring>How to check string starts with some sub-string?</h2><blockquote><p>The == comparison operator behaves differently within a double-brackets
test than within single brackets. See <a href=http://tldp.org/LDP/abs/html/comparison-ops.html>Other Comparison Operators</a></p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-shell data-lang=shell><span class=o>[</span><span class=o>[</span> <span class=nv>$a</span> <span class=o>=</span><span class=o>=</span> z* <span class=o>]</span><span class=o>]</span>   <span class=c1># True if $a starts with a &#34;z&#34; (wildcard matching).</span>
<span class=o>[</span><span class=o>[</span> <span class=nv>$a</span> <span class=o>=</span><span class=o>=</span> <span class=s2>&#34;z*&#34;</span> <span class=o>]</span><span class=o>]</span> <span class=c1># True if $a is equal to z* (literal matching).</span>
</code></pre></td></tr></table></div></div><h2 id=lcall><code>LC_ALL</code></h2><blockquote><p>It forces applications to use the default language for output
and forces sorting to be byte-wise
<code>LC_ALL</code> is the environment variable that overrides all the other localisation settings</p></blockquote><h2 id=what-does-echo-powerlevel9kdisableconfigurationwizardtrue--zshrc-means>What does <code>echo 'POWERLEVEL9K_DISABLE_CONFIGURATION_WIZARD=true' >>! ~/.zshrc</code> means</h2><blockquote><p>cmd &#187;! file will append stdout to file, creating the file if it does not already exist
If noclobber is not set then the ! has no effect</p></blockquote><h2 id=mac-iso-date-format-date-u-ymdthmsz1>Mac iso date format: <code>date -u +"%Y-%m-%dT%H:%M:%SZ"</code></h2><h2 id=single-brackets-vs-double-bracketshttpsscriptingosxcom201802singlebracketsvsdoublebrackets1><a href=https://scriptingosx.com/2018/02/single-brackets-vs-double-brackets/>Single Brackets vs Double Brackets</a></h2><blockquote><p>The single bracket [ is actually a command. It has the same functionality as the test command, except that the last argument needs to be the closing square bracket ]
A single bracket test will fail when one of its arguments is empty and gets substituted to nothing. You can prevent this error by quoting the variables (always a prudent solution)
Double brackets in bash are not a command but a part of the language syntax.
With double brackets you can also use two equals characters == for a more C like syntax. (or, better, use ((…)) syntax for arithmetic expressions)
Since the single bracket is a command, many characters it uses for its arguments need to be escaped to work properly; Double brackets interpret these characters properly. You can also use the (again more C like) && and || operators instead of -a and -o: <code>[[ ( $a == $b ) || ( $a == $c ) ]]</code>
With double brackets you can compare to * and ? wildcards, and bracket globbing […]. <code>a=hat; [[ $a = ?at ]] && echo match; [[ $a = [chrp]at ]] && echo match</code>
You can also use &lt; and > to compare strings lexicographically
And you get an operator =~ for regular expressions</p></blockquote><h2 id=how-to-check-string-starts-with-some-substring1>How to check string starts with some sub-string?</h2><blockquote><p>The == comparison operator behaves differently within a double-brackets
test than within single brackets. See <a href=http://tldp.org/LDP/abs/html/comparison-ops.html>Other Comparison Operators</a></p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-shell data-lang=shell><span class=o>[</span><span class=o>[</span> <span class=nv>$a</span> <span class=o>=</span><span class=o>=</span> z* <span class=o>]</span><span class=o>]</span>   <span class=c1># True if $a starts with a &#34;z&#34; (wildcard matching).</span>
<span class=o>[</span><span class=o>[</span> <span class=nv>$a</span> <span class=o>=</span><span class=o>=</span> <span class=s2>&#34;z*&#34;</span> <span class=o>]</span><span class=o>]</span> <span class=c1># True if $a is equal to z* (literal matching).</span>
</code></pre></td></tr></table></div></div><h2 id=lcall1><code>LC_ALL</code></h2><blockquote><p>It forces applications to use the default language for output
and forces sorting to be byte-wise
<code>LC_ALL</code> is the environment variable that overrides all the other localisation settings</p></blockquote><h2 id=redirect-output-to-stderr-exec-12>Redirect output to stderr: <code>exec 1>&2</code></h2><h2 id=how-can-i-make-press-any-key-to-continue>How can I make &ldquo;press any key to continue&rdquo;?</h2><p><code>read -p "Press enter to continue"</code> to press enter to continue</p><p><code>read -n 1 -s -r -p "Press any key to continue"</code> to press any key to continue, where <code>-n</code> defines the required character count to stop reading, <code>-s</code> hides the user's input, <code>-r</code> causes the string to be interpreted &ldquo;raw&rdquo; (without considering backslash escapes)</p><h2 id=scriptdir-cd--dirname-bashsource0---pwd--to-get-the-current-script-dir><code>SCRIPTDIR=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )</code> to get the current script dir</h2><h2 id=use-read-to-read-input-from-stdin-like-this-read-p-you-name-please-r-name>use <code>read</code> to read input from stdin like this: <code>read -p "you name please:" -r NAME</code></h2><h2 id=why-usrbinenv-bash-is-better-than-binbash>Why <code>#!/usr/bin/env bash</code> is better than <code>#!/bin/bash</code></h2><blockquote><p><code>#!/usr/bin/env</code> searches PATH for bash, and bash is not always in /bin, particularly on non-Linux systems.</p></blockquote><h2 id=bash-automated-testing-systemhttpsgithubcombatscorebatscore-could-be-used-to-test-bash-scripts-like-this><a href=https://github.com/bats-core/bats-core>Bash Automated Testing System</a> could be used to test bash scripts like this:</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sh data-lang=sh><span class=cp>#!/usr/bin/env bats
</span><span class=cp></span>@test <span class=s2>&#34;addition using bc&#34;</span> <span class=o>{</span>
  <span class=nv>result</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span><span class=nb>echo</span> 2+2 <span class=p>|</span> bc<span class=k>)</span><span class=s2>&#34;</span>
  <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$result</span><span class=s2>&#34;</span> -eq <span class=m>4</span> <span class=o>]</span>
<span class=o>}</span>

@test <span class=s2>&#34;addition using dc&#34;</span> <span class=o>{</span>
  <span class=nv>result</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span><span class=nb>echo</span> <span class=m>2</span> 2+p <span class=p>|</span> dc<span class=k>)</span><span class=s2>&#34;</span>
  <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$result</span><span class=s2>&#34;</span> -eq <span class=m>4</span> <span class=o>]</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>It is a nodejs package, and can be installed via <code>brew</code> like this: <code>brew install bats</code>, or <code>npm install -g bats</code></p><h2 id=about-shell-parameter-substituationhttpswwwcybercitibiztipsbashshellparametersubstitution2html><a href=https://www.cyberciti.biz/tips/bash-shell-parameter-substitution-2.html>About shell parameter substituation</a></h2><p>The syntax is:</p><pre><code>${var#Pattern}
${var##Pattern}
</code></pre><p>You can strip $var as per given pattern from front of $var. The first syntax removes shortest part of pattern and the second syntax removes the longest part of the pattern.
For example, for k8s sts created POD, it will have POD name like <em>peer-0</em>, to get the index of that POD, use <code>${HOSTNAME##*-}</code>, please note that <em>*</em> is needed here to match any char before <em>-</em></p><h2 varname=value id=difference-between-varnamevalue-and->Difference between <code>${varname:=value}</code> and `$</h2><p>The first one sets varname to value if varname is either unset or null, while the other only sets the value of varname if varname is currently unset</p><h2 id=what-does-colon--means-in-bash>What does colon <em>:</em> means in bash?</h2><pre><code>: is a shell builtin that is basically equivalent to the true command. It is often used as a no-op eg after an if statement. 
</code></pre></div><footer class=post-footer><nav class=post-nav><a class=prev href=/post/tips/mongodb/><i class="iconfont icon-left"></i><span class="prev-text nav-default">mongodb</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=/post/tips/nginx/><span class="next-text nav-default">nginx</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:leowa@outlook.com class="iconfont icon-email" title=email></a><a href=https://github.com/leowa class="iconfont icon-github" title=github></a><a href=http://localhost:1313/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=copyright-year>&copy;
2019 -
2020
<span class=heart><i class="iconfont icon-heart"></i></span><span class=author>Andy Zhang</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script type=text/javascript src=/dist/even.26188efa.min.js></script></body></html>